<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link
      rel="shortcut icon"
      type="image/x-icon"
      href="http://progressquest.com/favicon.ico"
    />
    <title>Sneeder Quest - New Character Wizard</title>
    <!-- 98.css library -->
    <link rel="stylesheet" href="https://unpkg.com/98.css" />
    <script src="json2.js"></script>
    <script src="jquery-3.6.0.js"></script>
    <script src="utils.js"></script>
    <script src="config.js"></script>
    <script src="newguy.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <style>
      body {
        background: url("assets/darkaliens.png") no-repeat center center fixed;
        background-size: cover;
        font-family: "MS Sans Serif", sans-serif;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
        box-sizing: border-box;
      }

      /* Custom title bar color to match theme */
      .title-bar {
        background: #9acd32;
        background: linear-gradient(
          90deg,
          rgba(154, 205, 50, 1) 56%,
          rgba(255, 255, 255, 1) 100%
        );
      }
      .title-bar-text {
        color: black;
      }

      .wizard-container {
        display: flex;
        justify-content: center;
        align-items: center;
        min-height: 100vh;
        padding: 20px;
        box-sizing: border-box;
      }

      .wizard-window {
        min-width: 720px;
        height: 520px;
        display: flex;
        flex-direction: column;
      }

      .wizard-body {
        flex: 1;
        display: flex;
        padding: 0;
        min-height: 0;
      }

      /* Sidebar */
      .sidebar {
        width: 164px;
        background: #c0c0c0;
        border-right: 1px solid #808080;
        padding: 8px;
        display: flex;
        flex-direction: column;
      }

      .sidebar fieldset {
        border: 2px inset #c0c0c0;
        padding: 8px;
        margin: 0;
        flex: 1;
        display: flex;
        flex-direction: column;
      }

      .sidebar legend {
        font-weight: bold;
        color: black;
        padding: 0 4px;
      }

      /* TreeView for steps */
      .tree-view {
        list-style: none;
        padding: 8px;
        margin: 0;
        flex: 1;
        border: 2px inset #c0c0c0;
        background: #c0c0c0;
      }

      .tree-view li {
        padding: 4px 0;
        color: #808080;
        font-size: 11px;
        list-style: none;
      }

      .tree-view li.completed {
        color: black;
      }

      .tree-view li.active {
        color: black;
        font-weight: bold;
      }

      /* Main content area */
      .main-content {
        flex: 1;
        padding: 8px;
        display: flex;
        flex-direction: column;
        background: #c0c0c0;
        min-height: 0;
        overflow: hidden;
      }

      .step-title {
        font-size: 13px;
        font-weight: bold;
        color: black;
        margin-bottom: 8px;
      }

      .step-description {
        color: #404040;
        margin-bottom: 20px;
        line-height: 1.4;
        font-size: 11px;
      }

      .content-area {
        flex: 1;
        display: flex;
        gap: 12px;
        min-height: 0;
        max-height: 380px;
      }

      /* Selection panels */
      .selection-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        max-width: 720px;
      }

      .selection-panel fieldset {
        flex: 1;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
        min-height: 0;
      }

      .selection-panel legend {
        font-weight: bold;
        color: black;
        padding: 0 4px;
      }

      /* Selection table styling */
      .table-container {
        flex: 1;
        background: black;
        border: 1px inset #c0c0c0;
        margin: 4px;
        overflow: auto;
        min-height: 0;
      }

      .selection-table {
        width: 100%;
        border-collapse: collapse;
        font-size: 11px;
        background: black;
      }

      .selection-table thead {
        background: #c0c0c0;
        border-bottom: 1px solid #808080;
        position: sticky;
        top: 0;
        z-index: 10;
      }

      .selection-table th {
        padding: 4px 8px;
        text-align: left;
        border-right: 1px solid #808080;
        font-weight: normal;
        background: #c0c0c0;
        color: black;
      }

      .selection-table th:last-child {
        border-right: none;
      }

      .selection-table tbody tr {
        border-bottom: 1px solid #333;
        cursor: pointer;
        background: black;
      }

      .selection-table tbody tr:hover {
        background: #111111;
      }

      .selection-table td {
        padding: 3px 3px;
        border-right: 1px solid #333;
        vertical-align: top;
        background: black;
        color: #00ff00;
        font-family: "Courier New", monospace;
      }

      .selection-table td:last-child {
        border-right: none;
      }

      .selector-cell {
        text-align: center;
        padding: 2px 2px !important;
        color: #ffff00;
        font-size: 14px;
        font-weight: bold;
      }

      /* Description panel */
      .description-panel {
        flex: 1;
        display: flex;
        flex-direction: column;
        min-width: 300px;
        max-width: 300px;
      }

      .description-panel fieldset {
        flex: 1;
        margin: 0;
        padding: 0;
        display: flex;
        flex-direction: column;
      }

      .description-content {
        flex: 1;
        background: black;
        color: #00ff00;
        font-family: "Courier New", monospace;
        padding: 12px;
        overflow-y: auto;
        font-size: 11px;
        line-height: 1.4;
        border: 1px inset #c0c0c0;
        margin: 4px;
      }

      .description-title {
        font-weight: bold;
        color: white;
        margin-bottom: 8px;
        font-size: 12px;
      }

      .description-bonus {
        color: #9acd32;
        font-style: italic;
        margin-bottom: 8px;
        font-size: 10px;
      }

      .description-text {
        color: #00ff00;
      }

      .no-selection {
        color: #808080;
        font-style: italic;
        text-align: center;
        margin-top: 60px;
      }

      /* Stats panel */
      .stats-panel {
        max-width: 300px;
        margin: 0 auto;
      }

      .stats-panel fieldset {
        padding: 12px;
      }

      .stats-table {
        width: 100%;
        border-collapse: separate;
        border-spacing: 2px;
      }

      .stats-table th {
        background: #c0c0c0;
        border: 1px outset #c0c0c0;
        padding: 3px 8px;
        font-size: 11px;
        text-align: left;
        color: black;
        font-weight: bold;
      }

      .stats-table td {
        background: black;
        border: 1px inset #c0c0c0;
        padding: 3px 8px;
        text-align: center;
        font-family: "Courier New", monospace;
        color: #00ff00;
        font-size: 11px;
      }

      .stats-total {
        background: #404040 !important;
        font-weight: bold;
        color: #9acd32 !important;
      }

      /* Details panel */
      .details-panel {
        max-width: 400px;
        margin: 0 auto;
      }

      .details-panel fieldset {
        padding: 16px;
      }

      .form-group {
        margin-bottom: 12px;
      }

      .form-group label {
        display: block;
        margin-bottom: 4px;
        font-weight: bold;
      }

      .button-group {
        display: flex;
        gap: 8px;
        align-items: center;
        margin-top: 12px;
      }

      /* Character summary */
      .character-summary {
        border: 2px inset #c0c0c0;
        background: #f0f0f0;
        padding: 12px;
        margin-top: 12px;
      }

      .summary-title {
        font-weight: bold;
        margin-bottom: 8px;
        color: #000080;
        border-bottom: 1px solid #c0c0c0;
        padding-bottom: 4px;
      }

      .summary-row {
        margin: 4px 0;
        display: flex;
      }

      .summary-label {
        font-weight: bold;
        display: inline-block;
        width: 80px;
        color: black;
      }

      .summary-value {
        color: #000080;
      }

      /* Status bar */
      .status-bar {
        background: #c0c0c0;
        border-top: 1px solid #808080;
        padding: 4px 12px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 11px;
      }

      .status-left {
        color: black;
      }

      .status-right {
        display: flex;
        gap: 8px;
      }

      /* Custom button styling for primary actions */
      .btn.primary {
        background: #9acd32;
        color: black;
        font-weight: bold;
      }

      .btn.primary:hover {
        background: #adff2f;
      }

      .btn.primary:active {
        background: #8bc34a;
      }

      /* Multiplayer section */
      .multiplayer-section {
        margin-top: 16px;
      }

      .multiplayer-section fieldset {
        padding: 12px;
      }

      /* Hide step content by default */
      .step-content {
        display: none;
        flex: 1;
        flex-direction: column;
      }

      .step-content.active {
        display: flex;
      }

      /* Custom scrollbars for panels and tables */
      .panel-content::-webkit-scrollbar,
      .description-content::-webkit-scrollbar,
      .table-container::-webkit-scrollbar {
        width: 16px;
      }

      .panel-content::-webkit-scrollbar-track,
      .description-content::-webkit-scrollbar-track,
      .table-container::-webkit-scrollbar-track {
        background: #c0c0c0;
        border: 1px inset #c0c0c0;
      }

      .panel-content::-webkit-scrollbar-thumb,
      .description-content::-webkit-scrollbar-thumb,
      .table-container::-webkit-scrollbar-thumb {
        background: #808080;
        border: 1px outset #808080;
      }

      .panel-content::-webkit-scrollbar-thumb:hover,
      .description-content::-webkit-scrollbar-thumb:hover,
      .table-container::-webkit-scrollbar-thumb:hover {
        background: #9acd32;
      }
    </style>
  </head>

  <body>
    <div class="wizard-container">
      <div class="window wizard-window">
        <div class="title-bar">
          <div class="title-bar-text">Sneeder Quest - New Character Wizard</div>
          <div class="title-bar-controls">
            <button
              aria-label="Close"
              onclick="window.location.href='roster.html'"
            ></button>
          </div>
        </div>

        <div class="window-body wizard-body">
          <!-- Sidebar -->
          <div class="sidebar">
            <ul class="tree-view">
              <li id="sidebar-step-1">1. Choose Race</li>
              <li id="sidebar-step-2">2. Choose Class</li>
              <li id="sidebar-step-3">3. Roll Stats</li>
              <li id="sidebar-step-4">4. Finalize</li>
            </ul>
          </div>

          <!-- Main content -->
          <div class="main-content">
            <!-- Step 1: Race Selection -->
            <div class="step-content active" id="step-race">
              <div class="step-title">Choose Your Race</div>
              <div class="step-description">
                Select a race for your character. Each race has different stat
                bonuses and abilities.
              </div>
              <div class="content-area">
                <div class="selection-panel">
                  <fieldset>
                    <legend>Races</legend>
                    <div class="table-container">
                      <table class="selection-table" id="races-table">
                        <thead>
                          <tr>
                            <th style="width: 30px"></th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody id="races">
                          <!-- Race rows will be inserted here -->
                        </tbody>
                      </table>
                    </div>
                  </fieldset>
                </div>
                <div class="description-panel">
                  <fieldset>
                    <legend>Description</legend>
                    <div class="description-content" id="race-description">
                      <div class="no-selection">
                        Select a race to view its description
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>

            <!-- Step 2: Class Selection -->
            <div class="step-content" id="step-class">
              <div class="step-title">Choose Your Class</div>
              <div class="step-description">
                Select a class that determines your character's skills and
                abilities.
              </div>
              <div class="content-area">
                <div class="selection-panel">
                  <fieldset>
                    <legend>Classes</legend>
                    <div class="table-container">
                      <table class="selection-table" id="classes-table">
                        <thead>
                          <tr>
                            <th style="width: 30px"></th>
                            <th></th>
                          </tr>
                        </thead>
                        <tbody id="classes">
                          <!-- Class rows will be inserted here -->
                        </tbody>
                      </table>
                    </div>
                  </fieldset>
                </div>
                <div class="description-panel">
                  <fieldset>
                    <legend>Description</legend>
                    <div class="description-content" id="class-description">
                      <div class="no-selection">
                        Select a class to view its description
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>

            <!-- Step 3: Stats -->
            <div class="step-content" id="step-stats">
              <div class="step-title">Roll Your Statistics</div>
              <div class="step-description">
                Roll for your character's base statistics. You can reroll if
                you're not satisfied with the results.
              </div>
              <div class="content-area">
                <div class="stats-panel">
                  <fieldset>
                    <legend>Character Statistics</legend>
                    <table class="stats-table">
                      <thead>
                        <tr>
                          <th>Stat</th>
                          <th>Value</th>
                        </tr>
                      </thead>
                      <tbody id="Stats">
                        <tr>
                          <td>STR</td>
                          <td id="STR">10</td>
                        </tr>
                        <tr>
                          <td>CON</td>
                          <td id="CON">10</td>
                        </tr>
                        <tr>
                          <td>DEX</td>
                          <td id="DEX">10</td>
                        </tr>
                        <tr>
                          <td>INT</td>
                          <td id="INT">10</td>
                        </tr>
                        <tr>
                          <td>WIS</td>
                          <td id="WIS">10</td>
                        </tr>
                        <tr>
                          <td>CHA</td>
                          <td id="CHA">10</td>
                        </tr>
                        <tr class="stats-total">
                          <td><strong>Total</strong></td>
                          <td id="Total">60</td>
                        </tr>
                      </tbody>
                    </table>
                    <div class="button-group">
                      <button class="btn" id="Reroll">Reroll</button>
                      <button class="btn" id="Unroll" disabled>Undo</button>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>

            <!-- Step 4: Finalize -->
            <div class="step-content" id="step-details">
              <div class="step-title">Finalize Your Character</div>
              <div class="step-description">
                Enter your character's name and review your choices.
              </div>
              <div class="content-area">
                <div class="details-panel">
                  <fieldset>
                    <legend>Character Details</legend>
                    <div class="form-group">
                      <label for="Name">Character Name:</label>
                      <input
                        type="text"
                        id="Name"
                        placeholder="Enter character name"
                      />
                      <div class="button-group">
                        <button class="btn" id="RandomName">Random Name</button>
                      </div>
                    </div>

                    <div class="multiplayer-section">
                      <fieldset>
                        <legend>Game Mode</legend>
                        <div class="field-row">
                          <input type="checkbox" id="multiplayer" />
                          <label for="multiplayer">Enable Multiplayer</label>
                        </div>
                      </fieldset>
                    </div>

                    <div class="character-summary">
                      <div class="summary-title">Character Summary</div>
                      <div class="summary-row">
                        <span class="summary-label">Name:</span>
                        <span class="summary-value" id="summary-name"
                          >Not set</span
                        >
                      </div>
                      <div class="summary-row">
                        <span class="summary-label">Race:</span>
                        <span class="summary-value" id="summary-race"
                          >Not selected</span
                        >
                      </div>
                      <div class="summary-row">
                        <span class="summary-label">Class:</span>
                        <span class="summary-value" id="summary-class"
                          >Not selected</span
                        >
                      </div>
                      <div class="summary-row">
                        <span class="summary-label">Total Stats:</span>
                        <span class="summary-value" id="summary-total">60</span>
                      </div>
                    </div>
                  </fieldset>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Status/Button Bar -->
        <div class="status-bar">
          <div class="status-left" id="step-info">Step 1 of 4</div>
          <div class="status-right">
            <button
              class="btn"
              id="back-button"
              onclick="previousStep()"
              disabled
            >
              ← Back
            </button>
            <button class="btn primary" id="next-button" onclick="nextStep()">
              Next →
            </button>
            <button
              class="btn primary"
              id="finish-button"
              onclick="createCharacter()"
              style="display: none"
            >
              Create Character
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Hidden compatibility elements -->
    <div style="display: none">
      <button id="Sold"></button>
      <div id="races-hidden"></div>
      <div id="classes-hidden"></div>
    </div>

    <script>
      let currentStep = 1;
      let selectedRace = null;
      let selectedClass = null;

      function updateSidebar() {
        for (let i = 1; i <= 4; i++) {
          const sidebarItem = document.getElementById(`sidebar-step-${i}`);
          if (i < currentStep) {
            sidebarItem.className = "completed";
          } else if (i === currentStep) {
            sidebarItem.className = "active";
          } else {
            sidebarItem.className = "";
          }
        }
      }

      function updateButtons() {
        const backButton = document.getElementById("back-button");
        const nextButton = document.getElementById("next-button");
        const finishButton = document.getElementById("finish-button");
        const stepInfo = document.getElementById("step-info");

        backButton.disabled = currentStep === 1;
        stepInfo.textContent = `Step ${currentStep} of 4`;

        if (currentStep === 4) {
          nextButton.style.display = "none";
          finishButton.style.display = "inline-block";
        } else {
          nextButton.style.display = "inline-block";
          finishButton.style.display = "none";

          // Enable/disable next button based on step completion
          if (currentStep === 1) {
            nextButton.disabled = !selectedRace;
          } else if (currentStep === 2) {
            nextButton.disabled = !selectedClass;
          } else {
            nextButton.disabled = false;
          }
        }
      }

      function showStep(step) {
        // Hide all steps
        document.querySelectorAll(".step-content").forEach((content) => {
          content.classList.remove("active");
        });

        // Show current step
        const stepMap = {
          1: "step-race",
          2: "step-class",
          3: "step-stats",
          4: "step-details",
        };

        document.getElementById(stepMap[step]).classList.add("active");
        updateSidebar();
        updateButtons();

        if (step === 4) {
          updateCharacterSummary();
        }
      }

      function nextStep() {
        if (currentStep < 4) {
          currentStep++;
          showStep(currentStep);
        }
      }

      function previousStep() {
        if (currentStep > 1) {
          currentStep--;
          showStep(currentStep);
        }
      }

      function updateCharacterSummary() {
        document.getElementById("summary-name").textContent =
          traits.Name || "Not set";
        document.getElementById("summary-race").textContent =
          traits.Race || "Not selected";
        document.getElementById("summary-class").textContent =
          traits.Class || "Not selected";
        document.getElementById("summary-total").textContent = total || 60;
      }

      function updateDescription(type, name) {
        const descriptionPanel = document.getElementById(`${type}-description`);

        // For now, just show the name and bonus without detailed descriptions
        let description = "No description... yet...";

        // You can add descriptions later by creating a descriptions object like:
        // const descriptions = {
        //   races: {
        //     "Pigman": "A proud swine-human hybrid with excellent health.",
        //     "Ashkenazi Jew": "Naturally charismatic and well-connected.",
        //     // ... etc
        //   },
        //   classes: {
        //     "Life Insurance Salesman": "Wise and hardy from dealing with difficult customers.",
        //     // ... etc
        //   }
        // };

        let bonus = "";
        if (type === "race") {
          const raceData = K.Races.find((r) => r.split("|")[0] === name);
          if (raceData) {
            bonus = raceData.split("|")[1];
          }
        } else if (type === "class") {
          const classData = K.Klasses.find((c) => c.split("|")[0] === name);
          if (classData) {
            bonus = classData.split("|")[1];
          }
        }

        descriptionPanel.innerHTML = `
    <div class="description-title">${name}</div>
    ${bonus ? `<div class="description-bonus">Bonus: +${bonus}</div>` : ""}
    <div class="description-text">${description}</div>
  `;
      }

      function createCharacter() {
        if (!traits.Name || !traits.Race || !traits.Class) {
          alert("Please complete all steps before creating your character.");
          return;
        }
        sold();
      }

      // Override the fill function for table-based selection
      window.originalFill = fill;
      window.fill = function (selector, array, traitName) {
        const container = $(selector);
        container.empty();

        array.forEach((item, index) => {
          const [name, bonus] = item.split("|");

          const row = $("<tr></tr>");
          row.attr("data-value", name);
          row.attr("data-trait", traitName);

          row.html(`
            <td class="selector-cell"></td>
            <td>${name}</td>
          `);

          row.on("click", function () {
            // Clear previous selections in this table
            $(this)
              .siblings("tr")
              .each(function () {
                $(this).find(".selector-cell").text("");
              });

            // Add arrow to current selection
            $(this).find(".selector-cell").text("►");

            const selectedValue = $(this).attr("data-value");
            const traitType = $(this).attr("data-trait");
            traits[traitType] = selectedValue;

            if (traitType === "Race") {
              selectedRace = selectedValue;
              updateDescription("race", selectedValue);
            } else if (traitType === "Class") {
              selectedClass = selectedValue;
              updateDescription("class", selectedValue);
            }

            updateButtons();
          });

          container.append(row);
        });
      };

      // Initialize when document is ready
      $(document).ready(function () {
        NewGuyFormLoad();
        showStep(1);

        // Handle name changes
        document.getElementById("Name").addEventListener("input", function () {
          traits.Name = this.value;
          if (currentStep === 4) {
            updateCharacterSummary();
          }
        });

        // Handle random name generation
        document
          .getElementById("RandomName")
          .addEventListener("click", function () {
            GenClick();
            document.getElementById("Name").value = traits.Name;
            if (currentStep === 4) {
              updateCharacterSummary();
            }
          });

        // Update total when stats change
        const originalRollEm = window.RollEm;
        window.RollEm = function () {
          originalRollEm();
          if (currentStep === 4) {
            setTimeout(updateCharacterSummary, 100);
          }
        };
      });
    </script>
  </body>
</html>
